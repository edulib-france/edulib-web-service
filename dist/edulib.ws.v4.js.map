{"version":3,"file":"edulib.ws.v4.js","sourceRoot":"","sources":["../src/edulib.ws.v4.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,kCAAqC;AACrC,uEAA6E;AAC7E,iCAAoC;AA2FpC;IAAgC,8BAAqB;IAEnD,oBAAsB,OAAiB;QAAvC,YACE,kBAAM,IAAI,EAAE,OAAO,CAAC,SACrB;QAFqB,aAAO,GAAP,OAAO,CAAU;;IAEvC,CAAC;IAEM,8BAAS,GAAhB;QACE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC;IACzE,CAAC;IAEM,6BAAQ,GAAf,UAAgB,EAAU;QACxB,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,aAAW,EAAI,CAAC,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC;IAC/E,CAAC;IAEM,+BAAU,GAAjB;QACE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC;IAC1E,CAAC;IAEM,8BAAS,GAAhB,UAAiB,EAAU;QACzB,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,cAAY,EAAI,CAAC,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC;IAChF,CAAC;IAEM,oCAAe,GAAtB;QACE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC;IAChF,CAAC;IAEM,mCAAc,GAArB,UAAsB,EAAU;QAC9B,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,oBAAkB,EAAI,CAAC,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC;IACtF,CAAC;IAEM,gCAAW,GAAlB;QACE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC;IAC3E,CAAC;IAEM,+BAAU,GAAjB,UAAkB,EAAU;QAC1B,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,eAAa,EAAI,CAAC,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC;IACjF,CAAC;IAEM,6CAAwB,GAA/B;QACE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,yBAAyB,CAAC,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC;IACzF,CAAC;IAEM,0CAAqB,GAA5B,UAA6B,GAAW;QACtC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,oCAAkC,GAAK,CAAC,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAA;IACtG,CAAC;IAEM,6CAAwB,GAA/B,UAAgC,EAAU,EAAE,SAAkB;QAC5D,IAAM,EAAE,GAAQ,EAAE,CAAC;QACnB,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;YAAC,EAAE,CAAC,UAAU,GAAG,SAAS,CAAC;QAAC,CAAC;QAC7C,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,6BAA2B,EAAE,cAAW,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,IAAA,EAAE,CAAC,CAAA;IAC1G,CAAC;IAEM,4CAAuB,GAA9B,UAA+B,EAAU;QACvC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,6BAA2B,EAAE,aAAU,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,CAAA;IACrG,CAAC;IAEM,+CAA0B,GAAjC,UAAkC,GAAW;QAC3C,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,+BAA6B,GAAK,CAAC,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC;IAClG,CAAC;IAEM,8CAAyB,GAAhC,UAAiC,GAAW,EAAE,IAAY;QACxD,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,+BAA6B,GAAG,mBAAc,IAAM,CAAC,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC;IACpH,CAAC;IAEM,oCAAe,GAAtB,UAAuB,IAAgB;QACrC,IAAM,IAAI,GAAG,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC;QACjC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,MAAA,EAAE,CAAC,CAAC;IACnF,CAAC;IAEM,oCAAe,GAAtB,UAAuB,EAAU,EAAE,IAAS;QAC1C,IAAM,IAAI,GAAG,EAAE,IAAI,MAAA,EAAE,CAAC;QACtB,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,iBAAe,EAAI,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,MAAA,EAAE,CAAC,CAAC;IACzF,CAAC;IAEM,kCAAa,GAApB,UAAqB,IAAc;QACjC,IAAM,IAAI,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAC/B,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,MAAA,EAAE,CAAC,CAAC;IACjF,CAAC;IAEM,kCAAa,GAApB,UAAqB,EAAU,EAAE,IAAS;QACxC,IAAM,IAAI,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAC/B,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,eAAa,EAAI,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,MAAA,EAAE,CAAC,CAAC;IACvF,CAAC;IAEM,yCAAoB,GAA3B,UAA4B,EAAU,EAAE,SAAiB;QACvD,IAAM,IAAI,GAAG,EAAE,UAAU,EAAE,SAAS,EAAE,CAAC;QACvC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,eAAa,EAAE,YAAS,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,MAAA,EAAE,CAAC,CAAC;IAC9F,CAAC;IAEM,2CAAsB,GAA7B,UAA8B,EAAU,EAAE,SAAiB;QACzD,IAAM,IAAI,GAAG,EAAE,UAAU,EAAE,SAAS,EAAE,CAAC;QACvC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,eAAa,EAAE,cAAW,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,MAAA,EAAE,CAAC,CAAC;IAChG,CAAC;IAEM,kCAAa,GAApB,UAAqB,IAAc;QAAnC,iBAiBC;QAhBC,IAAM,QAAQ,GAAG,OAAO,CAAC,KAAK,EAAE,CAAC;QACjC,IAAM,OAAO,GAAG,EAAE,cAAc,EAAE,mCAAmC,EAAE,CAAC;QACxE,IAAM,OAAO,GAAG,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,SAAA,EAAE,CAAA;QAC5E,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;QAC5B,IAAM,GAAG,GAAG,OAAO,CAAC,OAAO,EAAE,UAAC,GAAG,EAAE,GAAG,EAAE,IAAI;YAC1C,KAAI,CAAC,eAAe,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,UAAC,IAAI,IAAK,OAAA,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,EAAtB,CAAsB,EAAE,UAAC,GAAG,IAAK,OAAA,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,EAApB,CAAoB,CAAC,CAAC;QAC7G,CAAC,CAAC,CAAC;QACH,IAAM,QAAQ,GAAG,GAAG,CAAC,IAAI,EAAE,CAAC;QAC5B,QAAQ,CAAC,MAAM,CAAC,mCAAmC,EAAE,IAAI,CAAC,wBAAwB,CAAC,CAAC;QACpF,QAAQ,CAAC,MAAM,CAAC,oBAAoB,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;QACtD,QAAQ,CAAC,MAAM,CAAC,qBAAqB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACxD,QAAQ,CAAC,MAAM,CAAC,gBAAgB,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QAC9C,QAAQ,CAAC,MAAM,CAAC,mBAAmB,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;QACpD,CAAC,IAAI,CAAC,aAAa,IAAI,EAAE,CAAC,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,QAAQ,CAAC,MAAM,CAAC,0BAA0B,EAAE,CAAC,CAAC,EAA9C,CAA8C,CAAC,CAAC;QACxF,CAAC,IAAI,CAAC,WAAW,IAAI,EAAE,CAAC,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,QAAQ,CAAC,MAAM,CAAC,wBAAwB,EAAE,CAAC,CAAC,EAA5C,CAA4C,CAAC,CAAC;QACpF,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC;IAC1B,CAAC;IAEM,kCAAa,GAApB,UAAqB,EAAU,EAAE,IAAS;QACxC,IAAM,IAAI,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAC/B,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,eAAa,EAAI,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,MAAA,EAAE,CAAC,CAAC;IACvF,CAAC;IAEM,yCAAoB,GAA3B,UAA4B,EAAU,EAAE,SAAiB;QACvD,IAAM,IAAI,GAAG,EAAE,UAAU,EAAE,SAAS,EAAE,CAAC;QACvC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,eAAa,EAAE,YAAS,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,MAAA,EAAE,CAAC,CAAC;IAC9F,CAAC;IAEM,2CAAsB,GAA7B,UAA8B,EAAU,EAAE,SAAiB;QACzD,IAAM,IAAI,GAAG,EAAE,UAAU,EAAE,SAAS,EAAE,CAAC;QACvC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,eAAa,EAAE,cAAW,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,MAAA,EAAE,CAAC,CAAC;IAChG,CAAC;IAEH,iBAAC;AAAD,CAAC,AAhID,CAAgC,gDAAqB,GAgIpD;AAhIY,gCAAU;AAgItB,CAAC","sourcesContent":["import Promise = require('bluebird');\nimport { AbstractEdulibWSOAuth, IOptions } from './abstract.edulib.ws.oauth';\nimport request = require('request');\n\nexport interface IClassroom {\n  establishment_account_id: string;\n  school_level_id: string;\n  grade_id: string;\n  degree_id: string;\n  name: string;\n  code: string;\n  id?: string;\n}\n\nexport interface IEtablishmentUser {\n  establishment_account_id: string;\n  last_name: string;\n  first_name: string;\n  email: string;\n  password: string;\n}\n\nexport interface IStudent extends IEtablishmentUser {\n  classroom_id: string;\n  school_level_id?: string;\n  grade_id?: string;\n  degree_id?: string;\n}\n\nexport interface ITeacher extends IEtablishmentUser {\n  classroom_ids: string[];\n  subject_ids: string[];\n}\n\nexport interface IGrade {\n  id: string;\n  name: string;\n  slug: string;\n  order: number;\n  school_level_id: string;\n}\n\nexport interface ISchoolLevel {\n  id: string;\n  name: string;\n  slug: string;\n  order: number;\n}\n\nexport interface ISubject {\n  id: string;\n  name: string;\n  slug: string;\n  school_level_ids: string[];\n}\n\nexport interface IEtablishmentLicense {\n  id: string;\n  key: string;\n  start_validity_date: string;\n  end_validity_date: string;\n  license_article: {\n    isbn: string;\n    title: string;\n    availability_date_theoretical: string;\n    is_available_via_ent: boolean;\n  },\n  license_product: {\n    isbn: string;\n    title: string;\n    editor: string;\n    resource_type: string;\n    levels: string;\n    degrees: string;\n    subjects: string;\n    images: {\n      thumb: string;\n      small: string;\n      medium: string;\n      large: string;\n    }\n  },\n  license_offer: {\n    reference: string;\n    license_length: number;\n    unit_price: number;\n  },\n  created_at: string;\n  student_id: string;\n  teacher_id: string;\n  is_affected: true;\n}\n\nexport class EdulibWSV4 extends AbstractEdulibWSOAuth {\n\n  constructor(protected options: IOptions) {\n    super('v4', options);\n  }\n\n  public getGrades(): Promise<IGrade[]> {\n    return this.request({ uri: this.buildUrl('/grades'), method: 'GET', });\n  }\n\n  public getGrade(id: string): Promise<IGrade> {\n    return this.request({ uri: this.buildUrl(`/grades/${id}`), method: 'GET', });\n  }\n\n  public getDegrees(): Promise<any> {\n    return this.request({ uri: this.buildUrl('/degrees'), method: 'GET', });\n  }\n\n  public getDegree(id: string): Promise<any> {\n    return this.request({ uri: this.buildUrl(`/degrees/${id}`), method: 'GET', });\n  }\n\n  public getSchoolLevels(): Promise<ISchoolLevel[]> {\n    return this.request({ uri: this.buildUrl('/school_levels'), method: 'GET', });\n  }\n\n  public getSchoolLevel(id: string): Promise<ISchoolLevel> {\n    return this.request({ uri: this.buildUrl(`/school_levels/${id}`), method: 'GET', });\n  }\n\n  public getSubjects(): Promise<ISubject[]> {\n    return this.request({ uri: this.buildUrl('/subjects'), method: 'GET', });\n  }\n\n  public getSubject(id: string): Promise<ISubject> {\n    return this.request({ uri: this.buildUrl(`/subjects/${id}`), method: 'GET', });\n  }\n\n  public getEstablishmentAccounts(): Promise<any> {\n    return this.request({ uri: this.buildUrl('/establishment_accounts'), method: 'GET', });\n  }\n\n  public getEstablishmentByUAI(uai: string): Promise<any> {\n    return this.request({ uri: this.buildUrl(`/establishment_accounts/by-uai/${uai}`), method: 'GET', })\n  }\n\n  public getEstablishmentLicenses(id: string, articleId?: string): Promise<IEtablishmentLicense[]> {\n    const qs: any = {};\n    if (articleId) { qs.article_id = articleId; }\n    return this.request({ uri: this.buildUrl(`/establishment_accounts/${id}/licenses`), method: 'GET', qs })\n  }\n\n  public getEstablishmentCatalog(id: string): Promise<IEtablishmentLicense[]> {\n    return this.request({ uri: this.buildUrl(`/establishment_accounts/${id}/catalog`), method: 'GET' })\n  }\n\n  public getEstablishmentClassrooms(uai: string): Promise<IClassroom[]> {\n    return this.request({ uri: this.buildUrl(`/classrooms/establishment/${uai}`), method: 'GET', });\n  }\n\n  public getEstablishmentClassroom(uai: string, code: string): Promise<IClassroom> {\n    return this.request({ uri: this.buildUrl(`/classrooms/establishment/${uai}/classroom/${code}`), method: 'GET', });\n  }\n\n  public createClassroom(data: IClassroom): Promise<any> {\n    const form = { classroom: data };\n    return this.request({ uri: this.buildUrl('/classrooms'), method: 'POST', form });\n  }\n\n  public updateClassroom(id: string, data: any): Promise<any> {\n    const form = { data };\n    return this.request({ uri: this.buildUrl(`/classrooms/${id}`), method: 'POST', form });\n  }\n\n  public createStudent(data: IStudent): Promise<any> {\n    const form = { student: data };\n    return this.request({ uri: this.buildUrl('/students'), method: 'POST', form });\n  }\n\n  public updateStudent(id: string, data: any): Promise<any> {\n    const form = { student: data };\n    return this.request({ uri: this.buildUrl(`/students/${id}`), method: 'POST', form });\n  }\n\n  public assignStudentLicense(id: string, licenseId: string): Promise<any> {\n    const form = { license_id: licenseId };\n    return this.request({ uri: this.buildUrl(`/students/${id}/assign`), method: 'POST', form });\n  }\n\n  public unassignStudentLicense(id: string, licenseId: string): Promise<any> {\n    const form = { license_id: licenseId };\n    return this.request({ uri: this.buildUrl(`/students/${id}/unassign`), method: 'POST', form });\n  }\n\n  public createTeacher(data: ITeacher): Promise<any> {\n    const deferred = Promise.defer();\n    const headers = { 'Content-Type': 'application/x-www-form-urlencoded' };\n    const options = { uri: this.buildUrl('/teachers'), method: 'POST', headers }\n    this.updateOptions(options);\n    const req = request(options, (err, res, body) => {\n      this.processResponse(err, res, body).then((data) => deferred.resolve(data), (err) => deferred.reject(err));\n    });\n    const formData = req.form();\n    formData.append('teacher[establishment_account_id]', data.establishment_account_id);\n    formData.append('teacher[last_name]', data.last_name);\n    formData.append('teacher[first_name]', data.first_name);\n    formData.append('teacher[email]', data.email);\n    formData.append('teacher[password]', data.password);\n    (data.classroom_ids || []).forEach(d => formData.append('teacher[classroom_ids][]', d));\n    (data.subject_ids || []).forEach(d => formData.append('teacher[subject_ids][]', d));\n    return deferred.promise;\n  }\n\n  public updateTeacher(id: string, data: any): Promise<any> {\n    const form = { teacher: data };\n    return this.request({ uri: this.buildUrl(`/teachers/${id}`), method: 'POST', form });\n  }\n\n  public assignTeacherLicense(id: string, licenseId: string): Promise<any> {\n    const form = { license_id: licenseId };\n    return this.request({ uri: this.buildUrl(`/teachers/${id}/assign`), method: 'POST', form });\n  }\n\n  public unassignTeacherLicense(id: string, licenseId: string): Promise<any> {\n    const form = { license_id: licenseId };\n    return this.request({ uri: this.buildUrl(`/teachers/${id}/unassign`), method: 'POST', form });\n  }\n\n};"]}