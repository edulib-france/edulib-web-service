{"version":3,"file":"edulib.ws.v3.js","sourceRoot":"","sources":["../src/edulib.ws.v3.ts"],"names":[],"mappings":";;;;;;;;;;;;AACA,uEAA6E;AAgD7E;IAAgC,8BAAqB;IAEnD,oBAAsB,OAAiB;QAAvC,YACE,kBAAM,IAAI,EAAE,OAAO,CAAC,SACrB;QAFqB,aAAO,GAAP,OAAO,CAAU;;IAEvC,CAAC;IAEM,mCAAc,GAArB,UAAsB,GAAW,EAAE,KAAa;QAC9C,IAAM,EAAE,GAAG,EAAE,GAAG,KAAA,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC;QAClC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,wBAAwB,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,IAAA,EAAE,CAAC,CAAC;IAC3F,CAAC;IAEM,wCAAmB,GAA1B,UAA2B,QAAgB,EAAE,QAAgB;QAC3D,IAAM,EAAE,GAAG,EAAE,QAAQ,UAAA,EAAE,QAAQ,UAAA,EAAE,CAAC;QAClC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,gCAAgC,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,IAAA,EAAE,CAAC,CAAC;IACnG,CAAC;IAEM,iCAAY,GAAnB,UAAoB,MAAc,EAAE,KAAa;QAC/C,IAAM,IAAI,GAAG,EAAE,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC;QAChD,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,MAAA,EAAE,CAAC,CAAC;IAC1F,CAAC;IAEM,2CAAsB,GAA7B,UAA8B,GAAW;QACvC,IAAM,EAAE,GAAG,EAAE,GAAG,KAAA,EAAE,CAAC;QACnB,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,iCAAiC,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,IAAA,EAAE,CAAC,CAAC;IACpG,CAAC;IAEM,kCAAa,GAApB,UAAqB,GAAW,EAAE,UAAkB,EAAE,UAAkB,EAAE,QAAgB,EAAE,QAAgB;QAC1G,IAAM,IAAI,GAAG;YACX,eAAe,EAAE,QAAQ;YACzB,YAAY,EAAE,UAAU,EAAE,YAAY,EAAE,UAAU;YAClD,yBAAyB,EAAE,GAAG,EAAE,aAAa,EAAE,QAAQ;SACxD,CAAC;QACF,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,MAAA,EAAE,CAAC,CAAC;IACjF,CAAC;IAEH,iBAAC;AAAD,CAAC,AAnCD,CAAgC,gDAAqB,GAmCpD;AAnCY,gCAAU;AAmCtB,CAAC","sourcesContent":["import * as Promise from 'bluebird';\nimport { AbstractEdulibWSToken, IOptions } from './abstract.edulib.ws.token';\n\nexport interface IUser {\n  id: string;\n  email: string;\n  first_name: string;\n  last_name: string;\n  type: string;\n  edulib_password: string;\n  establishment_uai: string;\n  cas__sso_id: string;\n}\n\nexport interface ILicense {\n  id: string;\n  key: string;\n  slug: string;\n  start_validity_date: string;\n  end_validity_date: string;\n  license_article: {\n    isbn: number;\n    title: string;\n    availability_date_theoretical: string;\n    is_available_via_ent: boolean;\n  },\n  license_product: {\n    isbn: string;\n    title: string;\n    editor: string;\n    resource_type: string;\n    levels: string;\n    degrees: string;\n    subjects: string;\n    images: {\n      thumb: string;\n      small: string;\n      medium: string;\n      large: string;\n    }\n  },\n  license_offer: {\n    reference: string;\n    license_length: number;\n    unit_price: number;\n  },\n  created_at: string;\n}\n\nexport class EdulibWSV3 extends AbstractEdulibWSToken {\n\n  constructor(protected options: IOptions) {\n    super('v3', options);\n  }\n\n  public getUserBySsoId(uai: string, ssoId: string): Promise<IUser> {\n    const qs = { uai, sso_id: ssoId };\n    return this.request({ uri: this.buildUrl('/users/identify-by-sso'), method: 'GET', qs });\n  }\n\n  public getUserByCredential(username: string, password: string): Promise<IUser> {\n    const qs = { username, password };\n    return this.request({ uri: this.buildUrl('/users/identify-by-credentials'), method: 'GET', qs });\n  }\n\n  public setUserSsoId(userId: string, ssoId: string): Promise<any> {\n    const form = { user_id: userId, sso_id: ssoId };\n    return this.request({ uri: this.buildUrl('/users/set-sso-id'), method: 'PATCH', form });\n  }\n\n  public getEtablishmentCatalog(uai: string): Promise<any> {\n    const qs = { uai };\n    return this.request({ uri: this.buildUrl('/establishment_accounts/catalog'), method: 'GET', qs });\n  }\n\n  public createLicense(uai: string, productEan: string, articleEan: string, offerRef: string, quantity: number): Promise<any> {\n    const form = {\n      offer_reference: offerRef,\n      article_isbn: articleEan, product_isbn: productEan,\n      establishment_account_uai: uai, license_count: quantity\n    };\n    return this.request({ uri: this.buildUrl('/licenses'), method: 'POST', form });\n  }\n\n};"]}