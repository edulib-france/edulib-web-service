{"version":3,"file":"abstract.edulib.ws.oauth.js","sourceRoot":"","sources":["../src/abstract.edulib.ws.oauth.ts"],"names":[],"mappings":";;;;;;;;;;;;AACA,2DAAgF;AAoBhF;IAAoD,yCAAgB;IAIlE,+BAAsB,OAAe,EAAY,OAAiB;QAAlE,YACE,kBAAM,OAAO,EAAE,OAAO,CAAC,SACxB;QAFqB,aAAO,GAAP,OAAO,CAAQ;QAAY,aAAO,GAAP,OAAO,CAAU;;IAElE,CAAC;IAES,4CAAY,GAAtB,UAAuB,QAAgB,EAAE,QAAgB;QAAzD,iBAYC;QAXC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YAClB,GAAG,EAAK,IAAI,CAAC,IAAI,iBAAc;YAC/B,MAAM,EAAE,MAAM;YACd,IAAI,EAAE;gBACJ,QAAQ,UAAA;gBACR,QAAQ,UAAA;gBACR,UAAU,EAAE,UAAU;gBACtB,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,QAAQ;gBACzC,aAAa,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,YAAY;aAClD;SACF,CAAC,CAAC,IAAI,CAAC,UAAA,IAAI,IAAI,OAAA,KAAI,CAAC,IAAI,GAAG,IAAI,EAAhB,CAAgB,CAAC,CAAC;IACpC,CAAC;IAES,4CAAY,GAAtB;QACE,MAAM,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;IACjD,CAAC;IAEH,4BAAC;AAAD,CAAC,AA1BD,CAAoD,qCAAgB,GA0BnE;AA1BqB,sDAAqB;AA0B1C,CAAC","sourcesContent":["import Promise = require('bluebird');\nimport { AbstractEdulibWS, IOptions as IWSOptions } from './abstract.edulib.ws';\n\nexport interface IOAuthApp {\n  clientId: string;\n  clientSecret: string;\n}\n\nexport interface IOptions extends IWSOptions {\n  oAuthApp: IOAuthApp;\n}\n\nexport interface IAuth {\n  access_token: string;\n  token_type: string;\n  expires_in: number;\n  refresh_token: string;\n  scope: string;\n  created_at: number;\n}\n\nexport abstract class AbstractEdulibWSOAuth extends AbstractEdulibWS {\n\n  public auth: IAuth;\n\n  constructor(protected version: string, protected options: IOptions) {\n    super(version, options);\n  }\n\n  protected authenticate(username: string, password: string): Promise<IAuth> {\n    return this.request({\n      uri: `${this.host}/oauth/token`,\n      method: 'POST',\n      form: {\n        username,\n        password,\n        grant_type: 'password',\n        client_id: this.options.oAuthApp.clientId,\n        client_secret: this.options.oAuthApp.clientSecret\n      }\n    }).then(auth => this.auth = auth);\n  }\n\n  protected getAuthToken(): string {\n    return this.auth ? this.auth.access_token : '';\n  }\n\n};"]}